@model IEnumerable<EmployeeViewModel>
@using Employee.MvcClient.Models

@{
	ViewData["Title"] = "EMS";
}

<div class="d-flex justify-content-between align-items-center mb-4">
	<h1>Employee Management System</h1>
	<div>
		<a asp-controller="Statistics" asp-action="Index" class="btn btn-info">
			View statistics
		</a>
	</div>
</div>


<div class="container">
	<div class="row">

		<div class="mb-3 col-8">
			<form asp-action="Index" method="get" class="form-inline">
				<div class="input-group">
					<input type="number" name="searchId" class="form-control" placeholder="Search Employee by ID"
						   value="@Context.Request.Query["searchId"]"
						   oninput="if(this.value === '') this.form.submit();" />
					<button type="submit" class="btn btn-primary">Search</button>
				</div>
			</form>
		</div>
		<div class="table-responsive col-8">
			<table class="table table-striped table-hover">
				<thead class="table-dark">
					<tr>
						<th>Employee ID</th>
						<th>First Name</th>
						<th>Last Name</th>
						<th>Email</th>
						<th>Salary (SEK)</th>
						<th>Department ID</th>
						<th>Department Name</th>
						<th>Location</th>
					</tr>
				</thead>
				<tbody>
					@if (Model != null && Model.Any())
					{
						@foreach (var employee in Model)
						{
							<tr class="selectable-row" data-employee-id="@employee.EmployeeId">
								<td>@employee.EmployeeId</td>
								<td>@employee.FirstName</td>
								<td>@employee.LastName</td>
								<td>@(employee.Email ?? "N/A")</td>
								<td>@(employee.Salary?.ToString("C") ?? "N/A")</td>
								<td>@employee.DepartmentId</td>
								<td>@employee.Name</td>
								<td>@employee.Location</td>
							</tr>
						}
					}
					else
					{
						<tr>
							<td colspan="7" class="text-center">No employees found</td>
						</tr>
					}
				</tbody>
			</table>
		</div>

		<div class="col-4 mt-3">
			<div class="mb-3">
				<a asp-action="Create" class="btn btn-success w-25 p-2">Create</a>
			</div>

			<form asp-action="Edit" method="get" class="mb-3">
				<input type="hidden" id="editSelectedId" name="id" />
				<button type="submit" id="editBtn" class="btn btn-primary w-25 p-2">Edit</button>
			</form>

			<form asp-action="Delete" method="get" class="mb-3">
				<input type="hidden" id="deleteSelectedId" name="id" />
				<button type="submit" id="deleteBtn" class="btn btn-danger w-25 p-2">Delete</button>
			</form>
		</div>

	</div>
</div>

@section Scripts {
	@{
		await Html.RenderPartialAsync("_ValidationScriptsPartial");
	}

	<script>
		document.addEventListener("DOMContentLoaded", function () {
			const rows = document.querySelectorAll("tr.selectable-row");
			const editIdInput = document.getElementById("editSelectedId");
			const deleteIdInput = document.getElementById("deleteSelectedId");
			const editButton = document.getElementById("editBtn");
			const deleteButton = document.getElementById("deleteBtn");

			rows.forEach(row => {
				row.addEventListener("click", () => {

					rows.forEach(r => r.classList.remove("table-active", "bg-primary"));

					row.classList.add("table-active", "bg-primary");

					const id = row.dataset.employeeId;
					editIdInput.value = id;
					deleteIdInput.value = id;

					editButton.disabled = false;
					deleteButton.disabled = false;
				});
			});
		});
	</script>
}
